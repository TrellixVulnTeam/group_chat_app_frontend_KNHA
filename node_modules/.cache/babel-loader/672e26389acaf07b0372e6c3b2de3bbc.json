{"ast":null,"code":"var _jsxFileName = \"/Users/divyanshisaxena/Desktop/divyanshi/learning/gql/group-chat-app/client/src/pages/Chatroom.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, Fragment, useState } from 'react';\nimport { Col, Form, Button } from 'react-bootstrap';\nimport { gql, useLazyQuery, useMutation, useSubscription } from '@apollo/client';\nimport { useMessageDispatch, useMessageState } from '../context/message';\nimport Message from './Message';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst GET_MESSAGES = gql`\n  query getMessages($to: String!){\n    getMessages(to: $to){\n      content from to createdAt\n    }\n  }\n`;\nconst SEND_MESSAGE = gql`\n  mutation sendMessage($to: String! $content: String!){\n    sendMessage(to: $to content: $content){\n      id content from to createdAt\n    }\n  }\n`;\nconst NEW_MESSAGE = gql`\n  subscription newMessage {\n    newMessage{\n      id from content to createdAt\n    }\n  }\n`;\nexport const Chatroom = () => {\n  _s();\n\n  // const { user } = useAuthState()\n  const {\n    groups\n  } = useMessageState();\n  const dispatch = useMessageDispatch();\n  const [content, setContent] = useState('');\n  const selectedGroup = groups === null || groups === void 0 ? void 0 : groups.find(group => group.selected === true); // console.log('selected group : ', selectedGroup)\n\n  const messages = selectedGroup === null || selectedGroup === void 0 ? void 0 : selectedGroup.messages; // console.log('messages: ', messages)\n\n  const {\n    data: messageData,\n    error: messageError\n  } = useSubscription(NEW_MESSAGE);\n  const [getMessages, {\n    loading: messagesLoading,\n    data: messagesData\n  }] = useLazyQuery(GET_MESSAGES);\n  const [sendMessage] = useMutation(SEND_MESSAGE, {\n    onError: err => console.log(err)\n  });\n  useEffect(() => {\n    if (messageError) console.log(messageError);\n\n    if (messageData) {\n      const message = messageData.newMessage;\n      dispatch({\n        type: 'ADD_MESSAGE',\n        payload: {\n          groupname: message.to,\n          message\n        }\n      });\n    }\n  }, [messageError, messageData]);\n  useEffect(() => {\n    if (selectedGroup && !selectedGroup.messages) {\n      getMessages({\n        variables: {\n          to: selectedGroup.groupname\n        }\n      });\n    }\n  }, [selectedGroup]);\n  useEffect(() => {\n    if (messagesData) {\n      console.log('messages Data : ', messagesData);\n      dispatch({\n        type: 'SET_GROUP_MESSAGES',\n        payload: {\n          groupname: selectedGroup.groupname,\n          messages: messagesData.getMessages\n        }\n      });\n    }\n  }, [messagesData]);\n\n  const submitMessage = e => {\n    e.preventDefault();\n    if (content.trim() === '' || !selectedGroup) return;\n    console.log('send message: ', content);\n    setContent(''); //mutation for sending a message\n\n    sendMessage({\n      variables: {\n        to: selectedGroup.groupname,\n        content\n      }\n    });\n  };\n\n  let selectedChatMarkup;\n\n  if (!messages && !messagesLoading) {\n    selectedChatMarkup = /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"info-text\",\n      children: \"Select a friend\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 26\n    }, this);\n  } else if (messagesLoading) {\n    selectedChatMarkup = /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"info-text\",\n      children: \"loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 26\n    }, this);\n  } else if (messages.length > 0) {\n    selectedChatMarkup = messages.map((message, index) => /*#__PURE__*/_jsxDEV(Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(Message, {\n        message: message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 9\n      }, this), index === messages.length - 1 && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"invisible\",\n        children: /*#__PURE__*/_jsxDEV(\"hr\", {\n          className: \"m-0\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 11\n      }, this)]\n    }, message.id, true, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 7\n    }, this));\n  } else if (messages.length === 0) {\n    selectedChatMarkup = /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"info-text\",\n      children: \"You are now connected! send your first message\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 26\n    }, this);\n  }\n\n  const home = () => {\n    window.location.href = '/';\n  };\n\n  return /*#__PURE__*/_jsxDEV(Col, {\n    xs: 10,\n    md: 8,\n    className: \"chat-box p-2\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"outline-danger\",\n        className: \"\",\n        onClick: home,\n        children: \"Leave Room\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"messages-box d-flex flex-column-reverse mt-2 p-3\",\n      children: selectedChatMarkup\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"px-3 py-2 mb-3 mt-2\",\n      children: /*#__PURE__*/_jsxDEV(Form, {\n        onSubmit: submitMessage,\n        children: /*#__PURE__*/_jsxDEV(Form.Group, {\n          className: \"d-flex align-items-center m-0\",\n          children: [/*#__PURE__*/_jsxDEV(Form.Control, {\n            type: \"text\",\n            className: \"message-input rounded-pill p-3 border-0\",\n            placeholder: \"Type a message...\",\n            value: content,\n            onChange: e => setContent(e.target.value)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 129,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"fas fa-paper-plane fa-2x text-primary ms-2\",\n            role: \"button\",\n            onClick: submitMessage\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 132,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 116,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Chatroom, \"paZtA2ZdMhbsBu0BbhBG/Rc2LFE=\", false, function () {\n  return [useMessageState, useMessageDispatch, useSubscription, useLazyQuery, useMutation];\n});\n\n_c = Chatroom;\n\nvar _c;\n\n$RefreshReg$(_c, \"Chatroom\");","map":{"version":3,"sources":["/Users/divyanshisaxena/Desktop/divyanshi/learning/gql/group-chat-app/client/src/pages/Chatroom.js"],"names":["React","useEffect","Fragment","useState","Col","Form","Button","gql","useLazyQuery","useMutation","useSubscription","useMessageDispatch","useMessageState","Message","GET_MESSAGES","SEND_MESSAGE","NEW_MESSAGE","Chatroom","groups","dispatch","content","setContent","selectedGroup","find","group","selected","messages","data","messageData","error","messageError","getMessages","loading","messagesLoading","messagesData","sendMessage","onError","err","console","log","message","newMessage","type","payload","groupname","to","variables","submitMessage","e","preventDefault","trim","selectedChatMarkup","length","map","index","id","home","window","location","href","target","value"],"mappings":"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","sourcesContent":["import React, { useEffect, Fragment, useState } from 'react'\nimport { Col, Form, Button } from 'react-bootstrap'\nimport { gql, useLazyQuery, useMutation, useSubscription } from '@apollo/client'\nimport { useMessageDispatch, useMessageState } from '../context/message'\nimport Message from './Message'\n\nconst GET_MESSAGES = gql`\n  query getMessages($to: String!){\n    getMessages(to: $to){\n      content from to createdAt\n    }\n  }\n`\n\nconst SEND_MESSAGE = gql`\n  mutation sendMessage($to: String! $content: String!){\n    sendMessage(to: $to content: $content){\n      id content from to createdAt\n    }\n  }\n`\n\nconst NEW_MESSAGE = gql`\n  subscription newMessage {\n    newMessage{\n      id from content to createdAt\n    }\n  }\n`\nexport const Chatroom = () => {\n  // const { user } = useAuthState()\n  const { groups } = useMessageState()\n  const dispatch = useMessageDispatch()\n  const [content, setContent] = useState('')\n\n  const selectedGroup = groups?.find(group => group.selected === true)\n  // console.log('selected group : ', selectedGroup)\n  const messages = selectedGroup?.messages\n  // console.log('messages: ', messages)\n\n  const { data: messageData, error: messageError } = useSubscription(NEW_MESSAGE)\n\n  const [getMessages, { loading: messagesLoading, data: messagesData }] = useLazyQuery(GET_MESSAGES)\n\n  const [sendMessage] = useMutation(SEND_MESSAGE, {\n    onError: (err) => console.log(err),  \n  })\n\n  useEffect(() => {\n    if (messageError) console.log(messageError)\n    if (messageData) {\n      const message = messageData.newMessage\n      dispatch({\n        type: 'ADD_MESSAGE', payload: {\n          groupname: message.to,\n          message\n        }\n     })\n    }\n  }, [messageError, messageData])\n\n  useEffect(() => {\n    if (selectedGroup && !selectedGroup.messages) {\n      getMessages({ variables: { to: selectedGroup.groupname } })\n    }\n  }, [selectedGroup])\n\n  useEffect(() => {\n    if (messagesData) {\n      console.log('messages Data : ', messagesData)\n      dispatch({\n        type: 'SET_GROUP_MESSAGES', payload: {\n          groupname: selectedGroup.groupname,\n          messages: messagesData.getMessages\n      } })\n    }\n  },[messagesData])\n\n  const submitMessage = (e) => {\n    e.preventDefault()\n    if (content.trim() === '' || !selectedGroup) return\n    console.log('send message: ', content)\n    setContent('')\n    //mutation for sending a message\n    sendMessage({\n      variables: {\n        to: selectedGroup.groupname,\n        content\n    }})\n  }\n\n  let selectedChatMarkup\n  if (!messages && !messagesLoading) {\n    selectedChatMarkup = <p className=\"info-text\">Select a friend</p>\n  } else if (messagesLoading) {\n    selectedChatMarkup = <p className=\"info-text\">loading...</p>\n  } else if (messages.length > 0) {\n    selectedChatMarkup = messages.map((message, index) => (\n      <Fragment key={message.id}>\n        <Message message={message} />\n        {index === messages.length - 1 && (\n          <div className=\"invisible\">\n            <hr className=\"m-0\"/>\n          </div>\n        )}\n      </Fragment>\n    ))\n  } else if (messages.length === 0) {\n    selectedChatMarkup = <p className=\"info-text\">You are now connected! send your first message</p>\n  }\n\n  const home = () => {\n    window.location.href = '/'\n  }\n  return (\n    <Col xs={10} md={8} className=\"chat-box p-2\">\n      <div>\n        <Button variant=\"outline-danger\" className=\"\"\n          onClick={home}>Leave Room</Button>\n      </div>\n\n      <div className=\"messages-box d-flex flex-column-reverse mt-2 p-3\">\n        {selectedChatMarkup}\n      </div>\n      \n      <div className=\"px-3 py-2 mb-3 mt-2\">\n        <Form onSubmit={submitMessage}>\n          <Form.Group className=\"d-flex align-items-center m-0\">\n            <Form.Control type=\"text\" className=\"message-input rounded-pill p-3 border-0\"\n              placeholder=\"Type a message...\" value={content}\n              onChange={(e) => setContent(e.target.value)} />\n            <i className=\"fas fa-paper-plane fa-2x text-primary ms-2\"\n              role=\"button\"\n              onClick={submitMessage}></i>\n          </Form.Group>\n        </Form>\n      </div>\n    </Col>\n  )\n}"]},"metadata":{},"sourceType":"module"}