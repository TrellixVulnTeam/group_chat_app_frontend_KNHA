{"ast":null,"code":"var _jsxFileName = \"/Users/divyanshisaxena/Desktop/divyanshi/learning/gql/group-chat-app/client/src/pages/Chatroom.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, Fragment, useState } from 'react';\nimport { Col, Form } from 'react-bootstrap';\nimport { gql, useLazyQuery } from '@apollo/client';\nimport { useMessageDispatch, useMessageState } from '../context/message';\nimport Message from './Message';\nimport queryString from 'query-string';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst GET_MESSAGES = gql`\n  query getMessages($to: String!){\n    getMessages(to: $to){\n      content from to createdAt\n    }\n  }\n`;\nexport const Chatroom = () => {\n  _s();\n\n  const {\n    groups\n  } = useMessageState();\n  const dispatch = useMessageDispatch();\n  const [content, setContent] = useState(''); // const selectedGroup = groups?.find(group => group.selected === true)\n\n  console.log('groups: ', groups);\n  const gname = queryString.parse(window.location.search).group;\n  const selectedGroup = groups === null || groups === void 0 ? void 0 : groups.find(group => group.groupname === gname);\n  console.log('selected group : ', selectedGroup);\n  const messages = selectedGroup === null || selectedGroup === void 0 ? void 0 : selectedGroup.messages;\n  console.log('messages: ', messages);\n  const [getMessages, {\n    loading: messagesLoading,\n    data: messagesData\n  }] = useLazyQuery(GET_MESSAGES);\n  useEffect(() => {\n    if (selectedGroup && !selectedGroup.messages) {\n      getMessages({\n        variables: {\n          to: selectedGroup.groupname\n        }\n      });\n    }\n  }, [selectedGroup]);\n  useEffect(() => {\n    if (messagesData) {\n      console.log('messages Data : ', messagesData);\n      dispatch({\n        type: 'SET_GROUP_MESSAGES',\n        payload: {\n          groupname: selectedGroup.groupname,\n          messages: messagesData.getMessages\n        }\n      });\n    }\n  }, [messagesData]);\n\n  const submitMessage = e => {\n    e.preventDefault();\n    if (content.trim() === '' || !selectedGroup) return;\n    console.log('send message: ', content);\n    setContent(''); //mutation for sending a message\n    // sendMessage({\n    //   variables: {\n    //     to: selectedUser.username,\n    //     content\n    // }})\n  };\n\n  let selectedChatMarkup;\n\n  if (!messages && !messagesLoading) {\n    selectedChatMarkup = /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"info-text\",\n      children: \"Select a friend\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 26\n    }, this);\n  } else if (messagesLoading) {\n    selectedChatMarkup = /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"info-text\",\n      children: \"loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 26\n    }, this);\n  } else if (messages.length > 0) {\n    selectedChatMarkup = messages.map((message, index) => /*#__PURE__*/_jsxDEV(Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(Message, {\n        message: message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 69,\n        columnNumber: 9\n      }, this), index === messages.length - 1 && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"invisible\",\n        children: /*#__PURE__*/_jsxDEV(\"hr\", {\n          className: \"m-0\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 11\n      }, this)]\n    }, message.id, true, {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 7\n    }, this));\n  } else if (messages.length === 0) {\n    selectedChatMarkup = /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"info-text\",\n      children: \"You are now connected! send your first message\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 26\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(Col, {\n    xs: 10,\n    md: 8,\n    className: \"p-0\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"messages-box d-flex flex-column-reverse mt-2 p-3\",\n      children: selectedChatMarkup\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"px-3 py-2 mb-3 mt-2\",\n      children: /*#__PURE__*/_jsxDEV(Form, {\n        onSubmit: submitMessage,\n        children: /*#__PURE__*/_jsxDEV(Form.Group, {\n          className: \"d-flex align-items-center m-0\",\n          children: [/*#__PURE__*/_jsxDEV(Form.Control, {\n            type: \"text\",\n            className: \"message-input rounded-pill bg-secondary p-3 border-0\",\n            placeholder: \"Type a message...\",\n            value: content,\n            onChange: e => setContent(e.target.value)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 90,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"fas fa-paper-plane fa-2x text-primary ms-2\",\n            role: \"button\",\n            onClick: submitMessage\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 93,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 82,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Chatroom, \"8dzLBCULF+G7LrWc8jl6RxV7PU4=\", false, function () {\n  return [useMessageState, useMessageDispatch, useLazyQuery];\n});\n\n_c = Chatroom;\n\nvar _c;\n\n$RefreshReg$(_c, \"Chatroom\");","map":{"version":3,"sources":["/Users/divyanshisaxena/Desktop/divyanshi/learning/gql/group-chat-app/client/src/pages/Chatroom.js"],"names":["React","useEffect","Fragment","useState","Col","Form","gql","useLazyQuery","useMessageDispatch","useMessageState","Message","queryString","GET_MESSAGES","Chatroom","groups","dispatch","content","setContent","console","log","gname","parse","window","location","search","group","selectedGroup","find","groupname","messages","getMessages","loading","messagesLoading","data","messagesData","variables","to","type","payload","submitMessage","e","preventDefault","trim","selectedChatMarkup","length","map","message","index","id","target","value"],"mappings":"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","sourcesContent":["import React, { useEffect, Fragment, useState } from 'react'\nimport { Col, Form } from 'react-bootstrap'\nimport { gql, useLazyQuery } from '@apollo/client'\nimport { useMessageDispatch, useMessageState } from '../context/message'\nimport Message from './Message'\nimport queryString from 'query-string'\n\nconst GET_MESSAGES = gql`\n  query getMessages($to: String!){\n    getMessages(to: $to){\n      content from to createdAt\n    }\n  }\n`\n\nexport const Chatroom = () => {\n  const { groups } = useMessageState()\n  const dispatch = useMessageDispatch()\n  const [content, setContent] = useState('')\n\n  // const selectedGroup = groups?.find(group => group.selected === true)\n  console.log('groups: ', groups)\n  const gname = queryString.parse(window.location.search).group\n\n  const selectedGroup = groups?.find(group => group.groupname === gname)\n  console.log('selected group : ', selectedGroup)\n  const messages = selectedGroup?.messages\n  console.log('messages: ', messages)\n  const [getMessages, { loading: messagesLoading, data: messagesData }] = useLazyQuery(GET_MESSAGES)\n\n  useEffect(() => {\n    if (selectedGroup && !selectedGroup.messages) {\n      getMessages({ variables: { to: selectedGroup.groupname } })\n    }\n  }, [selectedGroup])\n\n  useEffect(() => {\n    if (messagesData) {\n      console.log('messages Data : ', messagesData)\n      dispatch({\n        type: 'SET_GROUP_MESSAGES', payload: {\n          groupname: selectedGroup.groupname,\n          messages: messagesData.getMessages\n      } })\n    }\n  },[messagesData])\n\n  const submitMessage = (e) => {\n    e.preventDefault()\n    if (content.trim() === '' || !selectedGroup) return\n    console.log('send message: ', content)\n    setContent('')\n    //mutation for sending a message\n    // sendMessage({\n    //   variables: {\n    //     to: selectedUser.username,\n    //     content\n    // }})\n  }\n\n  let selectedChatMarkup\n  if (!messages && !messagesLoading) {\n    selectedChatMarkup = <p className=\"info-text\">Select a friend</p>\n  } else if (messagesLoading) {\n    selectedChatMarkup = <p className=\"info-text\">loading...</p>\n  } else if (messages.length > 0) {\n    selectedChatMarkup = messages.map((message, index) => (\n      <Fragment key={message.id}>\n        <Message message={message} />\n        {index === messages.length - 1 && (\n          <div className=\"invisible\">\n            <hr className=\"m-0\"/>\n          </div>\n        )}\n      </Fragment>\n    ))\n  } else if (messages.length === 0) {\n    selectedChatMarkup = <p className=\"info-text\">You are now connected! send your first message</p>\n  }\n\n  return (\n    <Col xs={10} md={8} className=\"p-0\">\n      <div className=\"messages-box d-flex flex-column-reverse mt-2 p-3\">\n        {selectedChatMarkup}\n      </div>\n      \n      <div className=\"px-3 py-2 mb-3 mt-2\">\n        <Form onSubmit={submitMessage}>\n          <Form.Group className=\"d-flex align-items-center m-0\">\n            <Form.Control type=\"text\" className=\"message-input rounded-pill bg-secondary p-3 border-0\"\n              placeholder=\"Type a message...\" value={content}\n              onChange={(e) => setContent(e.target.value)} />\n            <i className=\"fas fa-paper-plane fa-2x text-primary ms-2\"\n              role=\"button\"\n              onClick={submitMessage}></i>\n          </Form.Group>\n        </Form>\n      </div>\n    </Col>\n  )\n}"]},"metadata":{},"sourceType":"module"}